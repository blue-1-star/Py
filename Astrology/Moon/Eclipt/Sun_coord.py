import math
from datetime import datetime, timezone

def julian_date(dt):
    """Вычисляет Юлианскую дату для заданного времени."""
    dt = dt.replace(tzinfo=timezone.utc)  # Переводим время в UTC
    jd = 367 * dt.year - int((7 * (dt.year + int((dt.month + 9) / 12))) / 4) + int((275 * dt.month) / 9) + dt.day + 1721013.5 + (dt.hour + dt.minute / 60 + dt.second / 3600) / 24
    return jd

def sun_coordinates(dt):
    """Вычисляет эклиптические координаты Солнца для заданной даты."""
    # Шаг 1: Вычисляем юлианскую дату
    jd = julian_date(dt)
    
    # Шаг 2: Определяем количество дней с эпохи J2000.0
    n = jd - 2451545.0

    # Шаг 3: Средняя долгота Солнца (в градусах)
    L = (280.460 + 0.9856474 * n) % 360

    # Шаг 4: Средняя аномалия (в градусах)
    g = (357.528 + 0.9856003 * n) % 360

    # Перевод в радианы
    g_rad = math.radians(g)

    # Шаг 5: Эклиптическая долгота Солнца (в градусах)
    ecliptic_longitude = (L + 1.915 * math.sin(g_rad) + 0.020 * math.sin(2 * g_rad)) % 360

    # Шаг 6: Эклиптические координаты (пренебрегаем наклоном орбиты)
    x = math.cos(math.radians(ecliptic_longitude))
    y = math.sin(math.radians(ecliptic_longitude))

    return ecliptic_longitude, x, y

# Пример использования
now = datetime.utcnow()
longitude, x, y = sun_coordinates(now)
print(f"Эклиптическая долгота Солнца: {longitude:.2f}°")
print(f"Гелиоцентрические координаты Солнца: x={x:.2f}, y={y:.2f}")



"""
Для вычисления эклиптической долготы (λ ) и широты (β) объекта в эклиптической системе координат
можно воспользоваться следующим подходом:
1. Эклиптическая долгота (λ)
Эклиптическая долгота — это угол между проекцией объекта на плоскость эклиптики
и направлением точки весеннего равноденствия. Она вычисляется следующим образом:
λ=arctan2(y,x),
где:x и y — гелиоцентрические координаты объекта в эклиптической системе координат
 (или в других координатах, преобразованных в эклиптическую систему).
Результат λ обычно выражается в градусах и находится в диапазоне от 0 до  360.
 Функция  arctan2  учитывает знаки x и y чтобы определить правильный квадрант угла.
"""
