Была задумана программа, которая по фотоизображениям
растений вычисляет прощадь зеленых листов, функция 
get_paper_area_px - вычисляет площадь масштабной линейки 
и в итоге мы получаем площади зеленых листов 
Но, к сожалению, get_paper_area_px  не смогла обеспечить решение задумангой
задачи, она не может выделить область линейки. 
Поэтому пришлось произвести измерения в ручном режиме 
с помощью ImageJ
Имеется Excel файл 
в котором в столбцах "File Name" и "Scale pix/mm" 
находятся данные о масштабах файла.
Имеется код, который должен был решать задачу получения площадей,
занимаемых растениями, на каждом из изображений. 
И производить сохранение результатов в файл.

Ты мог бы теперь модифицировать код, чтобы полученные ручным способом данные 
можно было включить в поток этих вычислений.
Файл с масштабами линейки 
"G:\My\sov\extract\plant1\file_list.xlsx"
folder_path = r"G:\My\sov\extract\plant1"

Далее код который не справился с задачей





line 118, in generate_excel_file
    img_date_time = get_date_taken(cur_img_path).split(" ")
Exception: Image G:\My\sov\extract\plant1\UGAN_02_1.jpg does not have EXIF data.

включи, пожалуйста, проверку и обработку ошибки об  EXIF данных, и продолжение без них 


Масштаб для файла UGAN_02_02o.jpg не найден. Пропускаем. 
Масштаб для файла UGAN_02_03.jpg не найден. Пропускаем.

Все данные в "G:\My\sov\extract\plant1\file_list.xlsx" - заполнены.
Непонятно почему масштаб не найден 

2025-03-18 20:00:50
Можешь модифицировать функцию 
def list_files_to_excel(folder_path, file_pattern="*", excel_file_name="file_list.xlsx"):
чтобы она дополнительно извлекала из файлов изображений размеры  width, height 
и сохраняла эти значения в двух соответствующих столбцах 
наряду с File Name, Size 
вот ее текущая версия:


возникла следующая проблема
при подсчете площади зеленых листов на изображении программа выдает некоторый результат
Как его верифицировать? 
На глаз кажется что результат неправильный
есть вопросы  по контурам выделений, в некоторых случаях имеются довольно значительные ошибки.  
Ты мог бы предложить функция для  генерирации рисунков с фигурами, с известны площадями,  раскрашенными зеленым цветом 
в таких диапазонах в которых их ищет наша программа
вот маска для этого которая выделяет листы
# Создаем маску для зелёных цветов
mask = cv.inRange(hsv_img, (40, 100, 20), (80, 255, 255)) 
исследуются снимки в которых по 6 растений - 3 в верхнем ряду, 3 в нижнем
Также на рисунке должен быть размещен масштабный прямоугольник
имеющий такую структуру как и в оригинале которую бы неплохо имитировать
Белый фон, вверху на полосе высотой  приблизительно 5 мм и длиной чуть больше 20 мм
текст :
Grid size 1 mm 
Bold every 10 mm
далее идут три верхние изображения растений,  - нужна имитация произвольных фигур 
с известными площадями в зеленом цвете попадающим в нашу маску и с размерностью изображения полученного из файла 
excel_file_name="file_list.xlsx" в полях Width (px), Height (px)
модельные примеры разместить в подкаталоге model каталога с оригинальными изображениями
управляющие параметры модели:
Площадь всех растений мм, соотношение площадей каждого из 6 растений в общей площади ( по умолчанию все 6
в равных долях ) 
некоторый цветвой регулятор для выбора цветов растений - по умолчанию пусть бросается  какой нибудь кубик
сохранения имитационных снимков в формате .jpg с именем "File Name" и суффиксом {file_name}_mod.jpg



далее сетка с ячейками 1 mm:  вертикально 11 линий, горизонтально 20 линий с жирными линиями окаймления 
по всем 4-м стронам а также вертикальная на 10 й( десятом мм - разделитель на половине горизонтали )
линии слабо голубого цвета
 
далее нижний ряд из трех фигур такого же рода.

В Excel файле сохранить параметры генерерации модельных изображений 
Имя файла, размеры изображения, цвета, площадь общая ( с кортежем пропорций для каждого из 6 изображений) в двух видах:
измеренная в  кв. мм или как процент площади покрытой зеленью ( от общей площади изображения)

2025-03-18 22:49:29
ты мог бы параметризировать пороги выделения зеленого цвета в программе 
ибо есть вопросы  по контурам выделений, в некоторых случаях имеются довольно значительные ошибки.  
Необходимо изменять пороги для лучшего выделения
Подскажи какие параметры нужно поставить для выделения более светлой компоненты зеленого ? 


2025-03-20 17:38:01

Функция  list_files_to_excel(folder_path, file_pattern="*", excel_file_name="file_list.xlsx"):
готовит первоначальный файл для ручного заполнения столбца Scale 
ты мог бы добавить в нее ещё один столбец Cam и заполнить его значением из  EXIF о модели 
камеры? 

2025-03-20 18:15:52

как ты считаешь - если проводится ручное измерение параметра Scale ( программой ImageJ) получено множество значений
для различных изображений, получены параметры -  Width, Height, Cam
Настройки камеры не меняются. Пренследуется цель добиться одинаковых условий при создании фото. 
Мы могли бы составить прогностическую модель для получения интересующего нас значения 
Scale pix/mm?  Как оценить прогнозируемую ошибку модели? 
И как построить ее адаптивно ибо измерения добавляются - модель может подстраиваться? 

2025-03-20 20:44:01


имеем формулу расчета
Scale pix/mm= 
Фокусное расстояние (мм)×Расстояние до объекта (мм)
Ширина сенсора (мм)×Разрешение изображения (пиксели)
​
но оказывается ведь в самом начале вычислений площади зеленых растений
был сделан ресайз изображения
resized_img = cv.resize(img, (500, 500), interpolation=cv.INTER_LINEAR)
ты можешь оценить влияние  этой операции
на параметр  Scale pix/mm
Как это взаимовлияет с параметрами разрешения камеры?  
какое мне брать разрешение изображения - то что в камере или то что стало после ресайза 500х500? 

2025-03-20 23:32:34

Необходимо более тщательно провести параметризацию для учета порогов 
lower_green=(35, 50, 50), upper_green=(85, 255, 255)

потому как в функции visualize_green_contours(img_path, output_folder)
остался неучтенный непараметризованный оператор 
mask = cv.inRange(hsv_img, (40, 100, 20), (80, 255, 255))

необходимо создать функцию для вычисления параметров 
resized_img = cv.resize(img, (500, 500), interpolation=cv.INTER_LINEAR)
вместо (500, 500) значения отражают пропорцию  Width, Height исходного изображения  
где width = 500  всегда 
а второй - height  вычисляется по формуле  x = ( 500 * Height)/Width
т.е resize делается с параметрами пропорций исходного изображения Width, Height
с приведением первого параметра к значению Base_resize = 500 и второго - как результат вычисления

полученный коэффициент масштабирования от проведения операции resize
необходимо учесть в дальнейших вычисленяих всех зависимых величин как SCALE (pix/mm)
"WHITE PIXELS MM^2" если необходимо и других 

Далее текущее состояние кода ( без масштабирования при resize)


Необходимо собрать данные из всех файлов Excel в каталоге 
"G:\My\sov\extract\plant\Data"  в один файл Excel файл Data_Plant 
в этом же каталоге
фильтр для отбора строк во всех файлах :
столбец "File Name"  первое число в содержимом ячейки из следующего списка
list_names = [ 1,2,10,12,14,15,16]
Например запись UGAN_02_03_d0.jpg  -> 2 входит в список и отбирается 
UGAN_05_3_d0.jpg -> 5  - не входит и пропускается

выбрать  данные из  столбцов из следующего списка
list_columns = [FILE NAME, SCALE (pix/mm),	WHITE PIXEL COUNT,	TOTAL PIXELS,	WHITE PIXEL PERCENTAGE,	WHITE PIXELS MM^2]




Можно ли сделать аналог - макрос в Fiji/ImageJ2?
использовать файлы изображения, заданные в списке имен файлов list_files_Fiji  из 
заданного каталога img_folder

вывести результат в Excel - файл в img_folder

--------------------------------------------------
2025-04-05 14:50:42

Можеш запропонувати або розпочати обговорення зі своїм керівництвом про деякі ідеї,
дослідження яких могло б бути цікавим

Є установка що заряджає ( іонізує ) воду і така вода має цілющі властивості.
я мигцем бачив результати, які навіть без спеціальних обрахунків, показували очевидне 
переважаюче зростання зелених ростків оброблених активованою водою в порівнянні зі звичайною.
Замовили б собі в ун-т таке устаткування і почали б цикл досліджень. 
Подробиці можу підготувати.

А хіба не цікаво було б продовжити дослідження впливу місячних циклів на продуктивність 
вирощування різних субстратів?

Якщо широкі маси дослідників так моляться на цей ImageJ чи не було б цікавим трохи автоматизувати 
можливості обрахунків з його допомогою? як от те що було в нас - купа фото яких треба обрахувати 
площі, відсотки площ ... ? Продуктивність ручної роботи - як черепаха з геопардом.










